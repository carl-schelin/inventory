<?php
# This listing is for the vulnerabilities that have no responsible groups
        $output = '';
        $product = '';
        $waiting = 0;
        $q_string  = "select vuln_id,vuln_interface,vuln_securityid,vuln_duplicate,inv_product,inv_name,int_server,";
        $q_string .= "int_addr,vuln_group ";
        $q_string .= "from inv_vulnerabilities ";
        $q_string .= "left join interface on interface.int_id           = inv_vulnerabilities.vuln_interface ";
        $q_string .= "left join inventory on inventory.inv_id           = interface.int_companyid ";
        $q_string .= "left join products on products.prod_id            = inventory.inv_product ";
        $q_string .= $q_location;
        $q_string .= "left join inv_vulnowner on inv_vulnowner.vul_interface = inv_vulnerabilities.vuln_interface and inv_vulnowner.vul_security = inv_vulnerabilities.vuln_securityid ";
        $q_string .= $where;
        $q_string .= $orderby;
        $q_inv_vulnerabilities = mysqli_query($db, $q_string) or die(header("Location: " . $Siteroot . "/error.php?script=" . $package . "&error=" . $q_string . "&mysql=" . mysqli_error($db)));
        if (mysqli_num_rows($q_inv_vulnerabilities) > 0) {
          while ($a_inv_vulnerabilities = mysqli_fetch_array($q_inv_vulnerabilities)) {

#            $waiting = "vulnerabilities";
#            print "document.getElementById('unassigned_mysql').innerHTML = '" . mysqli_real_escape_string($db, $waiting) . "';\n\n";

# get vulowner and ticket from interface id and security id in vulowner table
            $q_string  = "select vul_id,vul_group,vul_ticket,vul_exception,vul_description ";
            $q_string .= "from inv_vulnowner ";
            $q_string .= "where vul_security = " . $a_inv_vulnerabilities['vuln_securityid'] . " and vul_interface = " . $a_inv_vulnerabilities['vuln_interface'] . " ";
            $q_inv_vulnowner = mysqli_query($db, $q_string) or die(header("Location: " . $Siteroot . "/error.php?script=" . $package . "&error=" . $q_string . "&mysql=" . mysqli_error($db)));
            if (mysqli_num_rows($q_inv_vulnowner) == 0) {
              $a_inv_vulnowner = mysqli_fetch_array($q_inv_vulnowner);

#              $waiting = "vulnowner";
#              print "document.getElementById('unassigned_mysql').innerHTML = '" . mysqli_real_escape_string($db, $waiting) . "';\n\n";

              $linkstart = "<a href=\"#\" onclick=\"show_file('vulnerability.fill.php?id="  . $a_inv_vulnerabilities['vuln_id'] . "');showDiv('vulnerability-hide');\">";
              $linkend   = "</a>";

              if ($product != $prodname[$a_inv_vulnerabilities['inv_product']]) {
                $output   .= "<tr>";
                $output .= "  <th class=\"ui-state-default\" colspan=\"10\">" . $prodname[$a_inv_vulnerabilities['inv_product']] . "</th>\n";
                $output   .= "</tr>";
                $product = $prodname[$a_inv_vulnerabilities['inv_product']];
              }

              $class = "ui-widget-content";
              if ($sevname[$a_inv_vulnerabilities['vuln_securityid']] == 'Critical') {
                $class = "ui-state-error";
              }
              if ($sevname[$a_inv_vulnerabilities['vuln_securityid']] == 'High') {
                $class = "ui-state-highlight";
              }

              $duplicate = '';
              if ($a_inv_vulnerabilities['vuln_duplicate']) {
                $duplicate = "< ";
                $class = "ui-widget-content";
              }

              $output   .= "<tr>";
              $output   .= "  <td class=\"" . $class . " delete\">"       . $linkstart . $a_inv_vulnerabilities['vuln_securityid'] . $linkend . "</td>";
              $output   .= "  <td class=\"" . $class . "\">"              . $linkstart . $a_inv_vulnerabilities['inv_name']        . $linkend . "</td>";
              $output   .= "  <td class=\"" . $class . "\">"              . $linkstart . $a_inv_vulnerabilities['int_server']      . $linkend . "</td>";
              $output   .= "  <td class=\"" . $class . "\">"              . $linkstart . $a_inv_vulnerabilities['int_addr']        . $linkend . "</td>";
              $output   .= "  <td class=\"" . $class . "\">" . $duplicate . $linkstart . $secname[$a_inv_vulnerabilities['vuln_securityid']]        . " (" . $sevname[$a_inv_vulnerabilities['vuln_securityid']] . ")" . $linkend . "</td>";
              $output   .= "  <td class=\"" . $class . "\">"              . $linkstart . $grpname[$a_inv_vulnerabilities['vuln_group']]        . $linkend . "</td>";
              $output   .= "  <td class=\"" . $class . "\">"              . $linkstart . $grpname[$a_inv_vulnowner['vul_group']]              . $linkend . "</td>";
              if ($a_inv_vulnowner['vul_exception']) {
                $output   .= "  <td class=\"" . $class . "\">"            . $linkstart . "Exception"                           . $linkend . "</td>";
              } else {
                $output   .= "  <td class=\"" . $class . "\">"            . $linkstart . $a_inv_vulnowner['vul_ticket']            . $linkend . "</td>";
              }
              $output   .= "  <td class=\"" . $class . "\">"              . $linkstart . $a_inv_vulnowner['vul_description']        . $linkend . "</td>";
              $output   .= "  <td class=\"" . $class . "\"><input type=\"checkbox\"></td>";
              $output   .= "</tr>";
            }
          }
        } else {
          $output .= "<tr>";
          $output .= "  <td class=\"ui-widget-content\" colspan=\"9\">No records found</td>";
          $output .= "</tr>";
        }

        $output .= "</table>";

        mysqli_free_result($q_inv_vulnerabilities);

        print "document.getElementById('unassigned_mysql').innerHTML = '" . mysqli_real_escape_string($db, $help . $header . $output) . "';\n\n";

?>
